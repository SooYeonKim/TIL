# 멀리 있는 컴퓨터끼리는 이렇게 데이터를 주고받는다 - 조각화 이론

> "따라하면서 배우는 IT - 네트워크 기초(개정판)"을 듣고 정리한 내용입니다.
>
> https://www.youtube.com/playlist?list=PL0d8NnikouEWcF1jJueLdjRIC4HsUlULi

## IPv4의 조각화
### 조각화란?
- 큰 IP 패킷들이 적은 MTU(Maximum Transmission Unit)를 갖는 링크를 통하여 전송되려면 여러 개의 작은 패킷으로 쪼개어/조각화 되어 전송돼야 한다.
- 즉, 목적지까지 패킷을 전달하는 과정에 통과하는 각 라우터마다 전송에 적합한 프레임으로 변환이 필요하다.
- 일단 조각화되면, 최종 목적지에 도달할 때까지 재조립되지 않는 것이 일반적이다.
- IPv4에서는 발신지 뿐만 아니라 중간 라우터에서도 IP 조각화가 가능
- IPv6에서는 IP 단편화가 발신지에서만 가능
- 재조립은 항상 최종 수신지에서만 가능

### 여러 개의 패킷으로 조각화 된 패킷
<img src="./img/06_IPv4 조각화.PNG" height="400px">

- 원래 보내려는 데이터 자체가 11,980 bytes
- 앞에 IPv4 프로토콜이 붙음
- MTU가 3,300 byte로 설정이 되어 있다고 가정
- 내가 보내려는 데이터가 더 크기 때문에 최대 전송 단위에 맞춰서 이 데이터를 잘게 쪼개야 함
- MTU는 IPv4 프로토콜까지 합친 값 (IPv4 프로토콜 헤더의 길이가 보통 20 byte)
- 순수하게 보낼 수 있는 페이로드(데이터)는 3300 - 20 = 3280 byte 씩만 보낼 수 있음
- Offset은 8로 나눈 값으로 사용
- 마지막 패킷은 더 이상 뒤에 패킷이 없다는 의미로 MF를 0으로 세팅해서 알려줌
- 4개 패킷의 IP 프로토콜에 세팅되는 ID 값이 전부 같음

### 큰 데이터를 전송하는 패킷이 조각화하는 과정
<img src="./img/06_큰 데이터를 보낼 때 패킷이 조각화하는 과정.PNG" height="200px">
<br><img src="./img/06_큰 데이터를 보낼 때 패킷이 조각화하는 과정2.PNG" height="200px">

## 문제
- 보내려는 데이터 크기: 2379
- MTU: 980
- 몇 개의 패킷으로 쪼개지는가? 3개
- 첫번째 패킷의 데이터의 크기는 몇인가? 960
- 마지막 패킷의 데이터의 크기는 몇인가? 459